---
export const prerender = false;
import Layout from "../layouts/Layout.astro";
import { Icon } from "astro-icon/components";
import ProductCard from "../components/products/ProductCard.astro";
import { searchProducts } from "../services/product.service";

const searchQuery = Astro.url.searchParams.get("q")?.trim() || "";
const products = searchQuery ? await searchProducts(searchQuery) : [];
---

<Layout title={`MarketFlex | Buscar: ${searchQuery || "..."}`}>
    <section class="search-section">
        <h2 class="section-title">
            {
                searchQuery ? (
                    <>
                        Resultados para "
                        <span class="gradient-text">{searchQuery}</span>"
                        <span class="result-count">({products.length})</span>
                    </>
                ) : (
                    <>
                        Buscá tu próximo{" "}
                        <span class="gradient-text">producto</span>
                    </>
                )
            }
        </h2>

        {
            products.length > 0 ? (
                <div class="products-grid">
                    {products.map((product) => (
                        <ProductCard product={product} />
                    ))}
                </div>
            ) : searchQuery ? (
                <div class="empty-results">
                    <div class="empty-icon-wrapper">
                        <Icon name="lucide:search-x" class="empty-icon" />
                    </div>
                    <h3 class="empty-title">Sin resultados</h3>
                    <p>
                        No encontramos productos que coincidan con "
                        <strong>{searchQuery}</strong>".
                        <br />
                        Intentá con otras palabras clave o navegá por
                        categorías.
                    </p>
                    <div class="actions">
                        <a href="/" class="btn btn-secondary btn-sm">
                            Volver al Inicio
                        </a>
                        <a href="/search" class="btn btn-primary btn-sm">
                            Ver Todos los Productos
                        </a>
                    </div>
                </div>
            ) : (
                <div class="empty-results">
                    <div class="empty-icon-wrapper">
                        <Icon name="lucide:search" class="empty-icon" />
                    </div>
                    <h3 class="empty-title">¿Qué estás buscando?</h3>
                    <p>
                        Usá el buscador del menú para encontrar tu próximo
                        producto favorito.
                    </p>
                </div>
            )
        }
    </section>
</Layout>

<style>
    .search-section {
        padding: 4rem 1rem;
        max-width: 1200px;
        margin: 0 auto;
        min-height: 60vh;
    }

    .section-title {
        text-align: center;
        font-size: clamp(1.5rem, 4vw, 2.5rem);
        margin-bottom: 3rem;
        color: var(--foreground);
        font-weight: 800;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
        flex-wrap: wrap;
    }

    .result-count {
        font-size: 1rem;
        font-weight: 500;
        color: #9ca3af;
        margin-left: 0.25rem;
    }

    .products-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
        gap: 1.5rem;
        padding: 1rem;
    }

    @media (min-width: 1024px) {
        .products-grid {
            grid-template-columns: repeat(4, 1fr);
        }
    }

    /* Empty State Styling */
    .empty-results {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        text-align: center;
        padding: 6rem 2rem;
        background: rgba(0, 0, 0, 0.02);
        border-radius: 24px;
        border: 2px dashed rgba(0, 0, 0, 0.05);
        margin-top: 2rem;
        max-width: 600px;
        margin-left: auto;
        margin-right: auto;
    }

    .empty-icon-wrapper {
        background: white;
        padding: 1.5rem;
        border-radius: 50%;
        box-shadow: 0 10px 30px -10px rgba(0, 0, 0, 0.1);
        margin-bottom: 1.5rem;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .empty-icon {
        width: 48px;
        height: 48px;
        color: #9ca3af;
    }

    .empty-title {
        font-size: 1.5rem;
        font-weight: 700;
        color: var(--foreground);
        margin-bottom: 0.5rem;
    }

    .empty-results p {
        font-size: 1.1rem;
        color: #6b7280;
        margin-bottom: 2rem;
        max-width: 400px;
        line-height: 1.6;
    }

    .actions {
        display: flex;
        gap: 1rem;
        justify-content: center;
        flex-wrap: wrap;
    }
</style>
