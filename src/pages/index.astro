---
import Layout from "../layouts/Layout.astro";
import Notifications from "../components/common/Notifications";
import FeaturedProducts from "../components/products/FeaturedProducts.astro";
import ProductCarousel from "../components/products/ProductCarousel.astro";
import {
	getFeaturedProducts,
	getNewArrivals,
} from "../services/product.service";
import styles from "./styles/index.module.css";

const products = await getFeaturedProducts();
const { data: newArrivals } = await getNewArrivals(1, 7);
const user = Astro.url.searchParams.get("user") || "Usuario";
const isNewUser = Astro.url.searchParams.get("new") === "true";
const welcomeMessage = isNewUser
	? `¡Bienvenido, ${user}!`
	: `Bienvenido de nuevo, ${user}`;
---

<Layout title="MarketFlex | Premium Marketplace" showToaster={false}>
	<Notifications
		client:only="react"
		message={welcomeMessage}
		type="success"
		delay={200}
		position="top-center"
		requiredQueryParam="login_success"
	/>

	<FeaturedProducts products={products} />

	<ProductCarousel
		id="new-arrivals"
		title="Últimas"
		titleHighlight="Novedades"
		icon="lucide:sparkles"
		products={newArrivals}
		limit={7}
		viewMoreHref="/new-arrivals"
	/>
</Layout>
