---
import Layout from "../layouts/Layout.astro";
import Notifications from "../components/common/Notifications";
import FeaturedProducts from "../components/products/FeaturedProducts.astro";
import ProductCarousel from "../components/products/ProductCarousel.astro";
import {
	getFeaturedProducts,
	getNewArrivals,
} from "../services/product.service";

const products = await getFeaturedProducts();
const newArrivals = await getNewArrivals();
const user = Astro.url.searchParams.get("user") || "Usuario";
const isNewUser = Astro.url.searchParams.get("new") === "true";
const welcomeMessage = isNewUser
	? `¡Bienvenido, ${user}!`
	: `Bienvenido de nuevo, ${user}`;
---

<Layout title="MarketFlex | Premium Marketplace" showToaster={false}>
	<Notifications
		client:only="react"
		message={welcomeMessage}
		type="success"
		delay={200}
		position="top-center"
		requiredQueryParam="login_success"
	/>

	<FeaturedProducts products={products} />

	<ProductCarousel
		id="new-arrivals"
		title="Recién"
		titleHighlight="Llegados"
		icon="lucide:sparkles"
		products={newArrivals}
		limit={8}
		viewMoreHref="/search?sort=newest"
	/>
</Layout>

<style>
	/* Shared Products Section Styles (if needed for overall layout) */
	.products-section {
		padding: 4rem 1rem;
		max-width: 1200px;
		margin: 0 auto;
		--card-gap: 1.5rem;
	}
</style>
