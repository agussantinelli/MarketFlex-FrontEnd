---
import Layout from "../layouts/Layout.astro";
import PageCard from "../components/common/PageCard.astro";
import ConfirmationModal from "../components/common/ConfirmationModal.astro";
import styles from "./styles/profile.module.css";

// This will be a client-side only page for now to handle auth easily
---

<Layout title="Mi Perfil | MarketFlex">
    <main class={styles.profileContainer}>
        <PageCard maxWidth="900px">
            <div id="profile-content" class={styles.loading}>
                <!-- Loading State -->
                <div class={styles.loaderContainer}>
                    <div class={styles.loader}></div>
                    <p>Cargando tus datos...</p>
                </div>

                <!-- Error State -->
                <div class={styles.errorContainer}>
                    <p>No se pudieron cargar los datos del perfil.</p>
                    <button id="retry-btn" class={styles.retryBtn}
                        >Reintentar</button
                    >
                </div>

                <!-- Profile Data -->
                <div class={styles.profileData}>
                    <div class={styles.profileHeader}>
                        <div class={styles.avatarContainer}>
                            <img
                                id="profile-avatar"
                                src=""
                                alt="Avatar"
                                class={styles.profileAvatar}
                            />
                        </div>
                        <div class={styles.headerInfo}>
                            <h1 id="user-full-name">Cargando...</h1>
                            <span
                                id="social-google"
                                class={`${styles.badge} ${styles.socialBadge}`}
                                style="display: none;"
                            >
                                Conectado con Google
                            </span>
                            <span
                                id="social-facebook"
                                class={`${styles.badge} ${styles.socialBadge}`}
                                style="display: none;"
                            >
                                Conectado con Facebook
                            </span>
                        </div>
                    </div>

                    <div class={styles.profileGrid}>
                        <div class={styles.infoGroup}>
                            <label>Email</label>
                            <p id="user-email">...</p>
                        </div>
                        <div class={styles.infoGroup}>
                            <label>DNI / Identificación</label>
                            <p id="user-dni">...</p>
                        </div>
                        <div class={styles.infoGroup}>
                            <label>Fecha de Nacimiento</label>
                            <p id="user-birth">...</p>
                        </div>
                        <div class={styles.infoGroup}>
                            <label>Nacionalidad</label>
                            <p id="user-nationality">...</p>
                        </div>
                        <div class={styles.infoGroup}>
                            <label>Residencia</label>
                            <p id="user-residence">...</p>
                        </div>
                    </div>

                    <div class={styles.profileActions}>
                        <button id="logout-btn" class={styles.logoutBtn}
                            >Cerrar Sesión</button
                        >
                    </div>
                </div>
            </div>
        </PageCard>

        <ConfirmationModal
            id="logout-modal"
            title="¿Cerrar sesión?"
            message="¿Estás seguro que deseas cerrar tu sesión actual? Tendrás que volver a ingresar tus credenciales para acceder de nuevo."
            confirmText="Cerrar Sesión"
            cancelText="Cancelar"
            type="danger"
        />
    </main>

    <script>
        import { initProfile } from "../scripts/profile";
        import styles from "./styles/profile.module.css";
        import modalStyles from "../components/common/styles/ConfirmationModal.module.css";

        // Initialize on load
        initProfile(styles, modalStyles);

        // Support for View Transitions
        document.addEventListener("astro:page-load", () =>
            initProfile(styles, modalStyles),
        );
    </script>
</Layout>
