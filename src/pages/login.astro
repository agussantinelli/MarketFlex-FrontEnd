---
import Layout from "../layouts/Layout.astro";
import { Icon } from "astro-icon/components";
import Notifications from "../components/common/Notifications";
import AuthInputs from "../components/auth/AuthInputs.astro";
import styles from "./styles/login.module.css";
---

<Layout title="MarketFlex | Iniciar Sesión" simple={true}>
    <div class={styles.loginContainer}>
        <div class={styles.loginCard}>
            <!-- Back Button -->
            <a href="/" class={styles.backLink} aria-label="Volver al inicio">
                <Icon name="lucide:arrow-right" class={styles.backIcon} />
            </a>

            <!-- Decorative Crosses Pattern -->
            <div
                class={`${styles.decorativeCross} ${styles.decorativeDark}`}
                style="top: 15px; right: 15px;"
            >
            </div>
            <div
                class={`${styles.decorativeCross} ${styles.decorativeDark}`}
                style="bottom: 15px; left: 15px;"
            >
            </div>
            <div
                class={`${styles.decorativeCross} ${styles.decorativeDark}`}
                style="bottom: 15px; right: 15px;"
            >
            </div>

            <div
                class={`${styles.decorativeCross} ${styles.decorativeX}`}
                style="top: 50%; left: 15px; opacity: 0.3"
            >
            </div>
            <div
                class={`${styles.decorativeCross} ${styles.decorativeX}`}
                style="top: 50%; right: 15px; opacity: 0.3"
            >
            </div>

            <div
                class={`${styles.decorativeCross} ${styles.decorativeDarker}`}
                style="top: 15%; left: 50%; opacity: 0.2"
            >
            </div>
            <div
                class={`${styles.decorativeCross} ${styles.decorativeDarker}`}
                style="bottom: 15%; left: 50%; opacity: 0.2"
            >
            </div>

            <div
                class={`${styles.decorativeCross} ${styles.decorativeX} ${styles.decorativeDark}`}
                style="top: 25%; left: 10%; opacity: 0.15"
            >
            </div>
            <div
                class={`${styles.decorativeCross} ${styles.decorativeX} ${styles.decorativeDark}`}
                style="bottom: 25%; right: 10%; opacity: 0.15"
            >
            </div>

            <!-- Specific X shapes -->
            <div
                class={`${styles.decorativeCross} ${styles.decorativeX} ${styles.decorativeDarker}`}
                style="top: 10%; right: 40%; opacity: 0.15"
            >
            </div>
            <div
                class={`${styles.decorativeCross} ${styles.decorativeX} ${styles.decorativeDarker}`}
                style="bottom: 10%; left: 40%; opacity: 0.15"
            >
            </div>
            <div
                class={`${styles.decorativeCross} ${styles.decorativeX}`}
                style="bottom: 40%; right: 5%; opacity: 0.1"
            >
            </div>
            <div
                class={`${styles.decorativeCross} ${styles.decorativeX}`}
                style="top: 40%; left: 5%; opacity: 0.1"
            >
            </div>

            <div class={styles.loginHeader}>
                <a href="/" class={styles.logo}>
                    <img
                        src="/logo-marketflex-no-circle.png"
                        alt="MarketFlex Logo"
                        class={styles.logoImg}
                    />
                </a>
                <h1>Bienvenido de nuevo</h1>
                <p>Ingresa a tu cuenta para continuar</p>
            </div>

            <form class={`${styles.loginForm} login-form`}>
                <AuthInputs type="login" />

                <div class={styles.formOptions}>
                    <label class={styles.checkboxLabel}>
                        <input
                            type="checkbox"
                            name="remember"
                            class={styles.checkboxInput}
                        />
                        <span>Recordarme</span>
                    </label>
                    <a href="#" class={styles.forgotPassword}
                        >¿Olvidaste tu contraseña?</a
                    >
                </div>

                <button type="submit" class={`${styles.btnLogin} btn-login`}>
                    Iniciar Sesión
                    <Icon name="lucide:arrow-right" class={styles.btnIcon} />
                </button>
            </form>

            <div class={styles.divider}>
                <span>o continuar con</span>
            </div>

            <!-- Facebook SDK Root -->
            <div id="fb-root"></div>

            <div id="google-signin-button" class={styles.googleContainer}></div>
            <!-- Botón manual oculto por defecto, servirá de fallback si el SDK falla -->
            <button
                id="google-login-btn"
                class={styles.btnGoogle}
                type="button"
                style="display: none;"
            >
                <img
                    src="/logos/google.svg"
                    alt="Google"
                    width="20"
                    height="20"
                />
                Iniciar sesión con Google
            </button>

            <div id="fb-button-container" class={styles.facebookContainer}>
                <div
                    class="fb-login-button"
                    data-width="320"
                    data-size="large"
                    data-button-type="continue_with"
                    data-layout="default"
                    data-auto-logout-link="false"
                    data-use-continue-as="false"
                >
                </div>
            </div>

            <!-- Botón manual oculto por defecto -->
            <button
                id="fb-login-btn"
                class={styles.btnFacebook}
                type="button"
                style="display: none;"
            >
                <img
                    src="/logos/facebook.svg"
                    alt="Facebook"
                    width="20"
                    height="20"
                />
                Iniciar sesión con Facebook
            </button>

            <div class={styles.loginFooter}>
                <p>¿No tienes una cuenta? <a href="/register">Regístrate</a></p>
            </div>
        </div>
    </div>
    <Notifications
        client:only="react"
        message="Credenciales incorrectas"
        type="error"
        delay={100}
        position="top-center"
        requiredQueryParam="error"
    />
</Layout>

<script>
    import { initLogin } from "../scripts/auth-login";

    // Initialize on load
    initLogin();

    // Support for View Transitions
    document.addEventListener("astro:page-load", initLogin);
</script>
