---
import Layout from "../../layouts/Layout.astro";
import { HiArrowLeft, HiCreditCard, HiTruck } from "react-icons/hi2";
import styles from "./styles/order-detail.module.css";

const { id } = Astro.params;
---

<Layout title={`Orden #${id?.slice(0, 8).toUpperCase()} | MarketFlex`}>
    <main class={styles.ordersContainer}>
        <a href="/orders" class={styles.backLink}>
            <HiArrowLeft />
            Volver a mis compras
        </a>

        <div id="detail-loading" class={styles.emptyOrders}>
            <div class={styles.spinnerPremium}></div>
            <p class={styles.emptyText}>Cargando detalles de la orden...</p>
        </div>

        <div id="detail-content" style="display: none;">
            <header class={styles.orderDetailHeader}>
                <div>
                    <h1 class={styles.ordersTitle} id="order-id-title">
                        Orden #...
                    </h1>
                    <p class={styles.ordersSubtitle} id="order-date-full">
                        ...
                    </p>
                </div>
                <div>
                    <span class={styles.statusBadge} id="order-status-badge"
                        >COMPLETADA</span
                    >
                </div>
            </header>

            <div class={styles.orderDetailGrid}>
                <!-- Items Table -->
                <section class={styles.orderItemsSection}>
                    <h3>Artículos en esta orden</h3>
                    <table class={styles.orderItemsTable}>
                        <thead>
                            <tr>
                                <th>Producto</th>
                                <th>Cant.</th>
                                <th>Precio Unit.</th>
                                <th style="text-align: right;">Subtotal</th>
                            </tr>
                        </thead>
                        <tbody id="order-items-body">
                            <!-- Injected by JS -->
                        </tbody>
                    </table>
                </section>

                <!-- Sidebar with Info -->
                <aside class={styles.orderSidebar}>
                    <!-- Shipping Info -->
                    <div class={styles.sidebarCard}>
                        <h3>
                            <HiTruck
                                style={{
                                    display: "inline",
                                    marginRight: "0.5rem",
                                    verticalAlign: "middle",
                                }}
                            />
                            Detalles de Envío
                        </h3>
                        <div class={styles.shippingInfo}>
                            <p class={styles.productName} id="ship-name">...</p>
                            <p class={styles.shippingAddress} id="ship-address">
                                ...
                            </p>
                            <p
                                class={styles.shippingAddress}
                                id="ship-location"
                            >
                                ...
                            </p>
                            <div
                                class={styles.infoRow}
                                style="margin-top: 1rem; border-top: 1px solid rgba(255,255,255,0.05); padding-top: 1rem;"
                            >
                                <span class={styles.infoLabel}>Teléfono</span>
                                <span class={styles.infoValue} id="ship-phone"
                                    >...</span
                                >
                            </div>
                        </div>
                    </div>

                    <!-- Payment Info & Totals -->
                    <div class={styles.sidebarCard}>
                        <h3>
                            <HiCreditCard
                                style={{
                                    display: "inline",
                                    marginRight: "0.5rem",
                                    verticalAlign: "middle",
                                }}
                            />
                            Resumen de Pago
                        </h3>
                        <div class={styles.infoRow}>
                            <span class={styles.infoLabel}>Método</span>
                            <span
                                class={styles.infoValue}
                                style="text-transform: capitalize;"
                                id="pay-method">...</span
                            >
                        </div>
                        <div
                            class={styles.infoRow}
                            id="cuotas-row"
                            style="display: none;"
                        >
                            <span class={styles.infoLabel}>Cuotas</span>
                            <span class={styles.infoValue} id="pay-cuotas"
                                >...</span
                            >
                        </div>

                        <div class={styles.totalSection}>
                            <div class={styles.totalRow}>
                                <span class={styles.totalLabel}
                                    >Total Pagado</span
                                >
                                <span
                                    class={styles.totalAmount}
                                    id="order-total-amount">$0</span
                                >
                            </div>
                        </div>
                    </div>
                </aside>
            </div>
        </div>

        <!-- Error State -->
        <div
            id="detail-error"
            class={styles.emptyOrders}
            style="display: none;"
        >
            <h2 class={styles.emptyTitle}>No pudimos encontrar la orden</h2>
            <p class={styles.emptyText}>
                Hubo un problema al cargar los detalles. Es posible que el
                enlace sea inválido o la orden no exista.
            </p>
            <a href="/orders" class={styles.btnShop}>Ver mis compras</a>
        </div>
    </main>
</Layout>

<script define:vars={{ styles }}>
    import { initOrderDetail } from "../../scripts/order-detail";

    // Initialize
    initOrderDetail(styles);

    // Support View Transitions
    document.addEventListener("astro:page-load", () => initOrderDetail(styles));
</script>
