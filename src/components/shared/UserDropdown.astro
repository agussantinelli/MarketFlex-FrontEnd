---
import { Icon } from "astro-icon/components";
import ConfirmationModal from "../common/ConfirmationModal.astro";
import styles from "../../layouts/styles/Navbar.module.css";
---

<div class={`${styles.userDropdown} user-dropdown`}>
    <button
        class={`${styles.dropdownTrigger} dropdown-trigger`}
        id="user-dropdown-btn"
    >
        <span class={styles.userGreeting}
            >Hola, <span class="user-name-display" id="user-name">Usuario</span
            ></span
        >
        <Icon name="lucide:chevron-down" class={styles.dropdownIcon} />
    </button>

    <div class={`${styles.dropdownMenu} dropdown-menu`} id="user-dropdown-menu">
        <a href="/profile" class={styles.dropdownItem}>
            <Icon name="lucide:user" class={styles.itemIcon} />
            Mi Perfil
        </a>

        <!-- Client Purchases Link (Hidden in Admin Mode via JS) -->
        <a
            id="client-purchases-link"
            href="/orders"
            class={`${styles.dropdownItem} client-purchases-link`}
        >
            <Icon name="lucide:shopping-bag" class={styles.itemIcon} />
            Mis Compras
        </a>

        <div
            class={`${styles.dropdownDivider} admin-only`}
            style="display: none;"
        >
        </div>

        <!-- Admin Mode Button (Visible to admins when in client mode) -->
        <button
            class={`${styles.dropdownItem} admin-only go-admin-btn`}
            style="display: none;"
        >
            <Icon name="lucide:layout-dashboard" class={styles.itemIcon} />
            <span>Cambiar al Panel Administrador</span>
        </button>

        <button
            class={`${styles.dropdownItem} admin-only go-client-btn`}
            style="display: none;"
        >
            <Icon name="lucide:store" class={styles.itemIcon} />
            <span>Cambiar a Vista Cliente</span>
        </button>

        <div class={styles.dropdownDivider}></div>

        <button
            id="logout-btn"
            class={`${styles.dropdownItem} ${styles.textRed} logout-trigger-btn`}
        >
            <Icon name="lucide:log-out" class={styles.itemIcon} />
            Cerrar Sesión
        </button>
    </div>
</div>

<ConfirmationModal
    id="user-logout-modal"
    title="¿Cerrar sesión?"
    message="¿Estás seguro que deseas cerrar tu sesión actual? Tendrás que volver a ingresar tus credenciales para acceder de nuevo."
    confirmText="Cerrar Sesión"
    cancelText="Cancelar"
    type="danger"
/>

<script>
    import { initUserDropdown } from "../../scripts/userDropdown";
    import modalStyles from "../common/styles/ConfirmationModal.module.css";

    // Initialize component logic
    document.addEventListener("astro:page-load", () => {
        initUserDropdown(modalStyles);
    });

    // Run once on initial load as well
    initUserDropdown(modalStyles);
</script>
