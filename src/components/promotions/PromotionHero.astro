---
import { Icon } from "astro-icon/components";
import type { Promotion } from "../../types/promotion.types";
import styles from "./styles/PromotionHero.module.css";
import { getImageUrl } from "../../lib/url";

type Props = {
    promotions: Promotion[];
};

const { promotions: promotionsProp } = Astro.props;
const promotions = Array.isArray(promotionsProp) ? promotionsProp : [];

if (promotions.length === 0) return null;
---

<section class={styles.heroSection} aria-label="Promociones Destacadas">
    <div class={styles.heroContainer} data-hero-container>
        <div class={styles.heroTrack} data-hero-track>
            {
                promotions.map((promo, index) => (
                    <div
                        class={styles.heroSlide}
                        data-hero-slide
                        data-active={index === 0}
                    >
                        <div class={styles.slideContent}>
                            <div class={styles.textColumn}>
                                <div class={styles.badge}>
                                    <Icon name="lucide:zap" size={14} />
                                    <span>Destacado</span>
                                </div>
                                <h1 class={styles.title}>{promo.nombre}</h1>
                                <p class={styles.description}>
                                    {promo.descripcion}
                                </p>

                                <div class={styles.promoDetails}>
                                    {promo.tipoPromocion === "NxM" && (
                                        <div class={styles.promoTag}>
                                            <span class={styles.promoMain}>
                                                {promo.cantCompra}x
                                                {promo.cantPaga}
                                            </span>
                                            <span class={styles.promoSub}>
                                                Llevás {promo.cantCompra}, pagás{" "}
                                                {promo.cantPaga}
                                            </span>
                                        </div>
                                    )}
                                </div>

                                <a
                                    href={`/offers?promotion=${encodeURIComponent(promo.nombre)}&fixedKeys=promotion`}
                                    class={styles.ctaButton}
                                    aria-label={`Ver productos de la promoción: ${promo.nombre}`}
                                >
                                    Ver Productos
                                    <Icon
                                        name="lucide:arrow-right"
                                        size={20}
                                        aria-hidden="true"
                                    />
                                </a>
                            </div>

                            <div class={styles.imageColumn}>
                                <div class={styles.imageWrapper}>
                                    {promo.foto && (
                                        <img
                                            src={getImageUrl(promo.foto)}
                                            alt={`Foto de promoción: ${promo.nombre}`}
                                            class={styles.promoImage}
                                            width="800"
                                            height="600"
                                            loading="eager"
                                        />
                                    )}
                                </div>
                            </div>
                        </div>
                    </div>
                ))
            }
        </div>

        {
            promotions.length > 1 && (
                <>
                    <div class={styles.indicators}>
                        {promotions.map((_, index) => (
                            <button
                                class={styles.indicator}
                                data-hero-indicator={index}
                                data-active={index === 0}
                                aria-label={`Ir a promoción ${index + 1}`}
                            />
                        ))}
                    </div>

                    <button
                        class={`${styles.navBtn} ${styles.prev}`}
                        data-hero-prev
                        aria-label="Anterior"
                    >
                        <Icon name="lucide:chevron-left" size={28} />
                    </button>
                    <button
                        class={`${styles.navBtn} ${styles.next}`}
                        data-hero-next
                        aria-label="Siguiente"
                    >
                        <Icon name="lucide:chevron-right" size={28} />
                    </button>
                </>
            )
        }
    </div>
</section>

<script>
    import { setupHero } from "../../scripts/promotion-hero";

    // Run on init
    setupHero();
    // Run on page change
    document.addEventListener("astro:page-load", setupHero);
</script>
