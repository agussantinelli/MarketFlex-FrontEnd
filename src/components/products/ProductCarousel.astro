---
import { Icon } from "astro-icon/components";
import ProductCard from "./ProductCard.astro";
import type { Product } from "../../types/product.types";
import styles from "./styles/ProductCarousel.module.css";

interface Props {
    title: string;
    titleHighlight?: string;
    icon?: string;
    products: Product[];
    limit?: number;
    viewMoreHref?: string;
    id: string;
}

const {
    title,
    titleHighlight,
    icon,
    products,
    limit = 8,
    viewMoreHref = "/search",
    id,
} = Astro.props;

const displayProducts = products.slice(0, limit);
---

<section
    class={`${styles.productsSection} ${styles.carouselSection}`}
    id={id}
    data-carousel
>
    <h2 class={styles.sectionTitle}>
        {title}
        {titleHighlight && <span class="gradient-text">{titleHighlight}</span>}
        {icon && <Icon name={icon} class={styles.titleIcon} />}
    </h2>

    <div class={styles.carouselWrapper}>
        <button
            class={`${styles.carouselBtn} ${styles.prev}`}
            aria-label="Anterior"
            data-carousel-prev
        >
            <Icon name="lucide:chevron-left" size={24} />
        </button>

        <div class={styles.carouselContainer} data-carousel-container>
            <div class={styles.carouselTrack}>
                {
                    displayProducts.map((product) => (
                        <div class={styles.carouselItem} data-carousel-item>
                            <ProductCard
                                product={product}
                                showFeatured={false}
                            />
                        </div>
                    ))
                }

                <div
                    class={`${styles.carouselItem} ${styles.viewMoreCard}`}
                    data-carousel-item
                >
                    <a href={viewMoreHref} class={styles.viewMoreBtn}>
                        <div class={styles.iconWrapper}>
                            <Icon name="lucide:arrow-right" size={32} />
                        </div>
                        <span>Ver m√°s</span>
                    </a>
                </div>
            </div>
        </div>

        <button
            class={`${styles.carouselBtn} ${styles.next}`}
            aria-label="Siguiente"
            data-carousel-next
        >
            <Icon name="lucide:chevron-right" size={24} />
        </button>
    </div>
</section>

<script>
    import { setupAllProductCarousels } from "../../scripts/carousel";

    // Initialize on load
    setupAllProductCarousels();

    // Support for View Transitions
    document.addEventListener("astro:page-load", setupAllProductCarousels);
</script>
